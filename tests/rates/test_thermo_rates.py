from multibind.nonequilibrium import rate_matrix
import numpy as np


class TestThermoRates(object):

    def test_matrix_regression(self):
        """Are results equal to the previous 'correct' results?"""
        c, matrix = rate_matrix("../examples/rates/inputs/inputs/rates.csv")

        expected = np.array([[0.00000000e+00, 5.57242011e-02, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 2.79375886e+04],
                             [1.75947730e+10, 0.00000000e+00, 1.02000002e+10, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00],
                             [0.00000000e+00, 3.76999993e+07, 0.00000000e+00, 2.21842196e+05, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00],
                             [0.00000000e+00, 0.00000000e+00, 1.75947730e+10, 0.00000000e+00, 6.58803908e+04, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00],
                             [0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 4.86045874e+04, 0.00000000e+00, 1.75947730e+10, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00],
                             [0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 5.55550074e+05, 0.00000000e+00, 1.86999997e+07, 0.00000000e+00, 0.00000000e+00],
                             [0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 4.61000007e+09, 0.00000000e+00, 1.75947730e+10, 0.00000000e+00],
                             [0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 1.39547871e-01, 0.00000000e+00, 5.43754064e+04],
                             [1.15443517e+05, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 5.32970460e+04, 0.00000000e+00]])

        assert np.allclose(matrix, expected)

